---
layout: post
title:  "Deep Photo Enhancer"
date:   2021-02-08
excerpt: "Deep Photo Enhancer 이해하기"
tag:
- Tensorflow 
- Keras
- python
- IE
comments: true
---

## Deep Photo Enhancer

&nbsp;&nbsp;&nbsp;&nbsp;Deep Photo Enhancer는 2018년 CVPR에 Accepted된 논문으로, image enhnacement를 위한 Unpaired learning method를 제시하고 있습니다. 원하는 스타일로 향상된 이미지 데이터셋을 통해 이미지 향상 방법을 학습하고
input image들을 해당 스타일로 향상 시켜줍니다. DPE의 구조는 U-Net 구조에 기반한 2-way GANs을 사용합니다. Global U-Net을 GAN model의 Generator로 사용하며,
WGAN을 적응형 가중치 스키마(adaptive weighting scheme)로 발전된 WGAN을 사용합니다. 마지막으로, 독립적인 batch normalization layer를 사용하여 input distributions에
더 맞게 적응하도록 GAN 학습 방법을 변경하였습니다. 이러한 구조들을 통해 DPE는 보다 더 효과적인 image enhancement를 수행할 수 있었다고 합니다.

### Introduction

&nbsp;&nbsp;&nbsp;&nbsp;DPE 는 Unpaired learning을 수행하기 때문에, 사용자가 생각하는 "보기좋은" 이미지의 dataset만 준비하면 해당 dataset의 특성을 학습하여 input image를 "좋은" 이미지로
만들어줍니다. 이러한 "좋은" 이미지들은 웹사이트에서 쉽게 구할 수 있기 대문에, 기존의 enhancement 학습 방식인 image-to-image 의 translation 문제를 해결했다고 할 수 있습니다.
DPE에서는 학습을 CycleGAN과 비슷한 형태인 2-way GAN을 통해 진행하는데, GAN 자체가 워낙 불안정한 학습으로 유명한 방식이다 보니, 안정화를 위한 구조가 필요하게 되었습니다.
먼저 Global U-Net을 이용하여 Generator를 만듭니다. 그리고 WGAN의 방식을 사용하는데, WGAN이 사용하는 Lipschitz constraint이 penalty의 가중치 파라미터 변화에 매우
민감하므로, 이 방식을 이용하여 WGAN 학습의 수렴을 더 발전시켰습니다.(이 부분은 WGAN 관련 논문을 읽어봐야 할 거 같다.) 마지막으로, 대부분의 2-way GAN 방식이 같은 generator를 사용해서 input과 output이 유사하게 mapping되도록 하는데, DPE에서는 같은 domain에서도 input들은 사실상 다른 source로 부터
온다는 것을 발견하였습니다.(한 쪽은 input data 에서, 다른 한 쪽은 generator를 통해) 이러한 불일치가 generator에 악영향을 줄 수 있으므로, DPE에서는 batch norm layer를 각 generator에 넣음으로써
generator가 input data 에 맞게 학습되도록 하였습니다.

### Overview

![dpe_fig1](/assets/img/dpe/fig1.png)

&nbsp;&nbsp;&nbsp;&nbsp;DPE의 구조는 위 fig1과 같은 모습입니다. Source domain인 $$X$$는 원본 이미지이며, target domain $$Y$$는 원하는 enhancement 특징을 가지는 image들입니다.  
Fig1의 (a)의 경우에는 1-way GAN의 모습을 보여줍니다.원본 이미지 $$X$$는 Generator를 통해 y의 특징을 갖는 $$Y'$$ 으로 변환되고, Discriminator $$D_Y$$는 target domain  
y와 generator로 생성된 sample x'를 구분합니다. fig 1 의 (b)는 2-way GANs 방식에 대해 표현한 그림인데, forward pass 에서는 $$x\xrightarrow{G_X}y'\xrightarrow{G'_Y}x''$$의 순서로 이루어지며, $$x$$와 $$x''$$ 사이의 consistency 를 검증하게 됩니다. backward pass의 경우, $$y\xrightarrow{G_Y}x'\xrightarrow{G'_X}y''$$의 순서로 이루어지며, $$y$$와 $$y''$$ 사이의 consistency 를 검증하게 됩니다. 이들의 구현을 위해 이후 section들에서는 각각 generator와 1-way GAN, 그리고 2-way GANs에 대한 구현 방법을 각각 설명합니다.  
 
### Generator

### One-way GAN

### Two-way GAN

### Results
